
# 今週

【営業在庫】　7月実装完了　8月にて完全に完了の想定

◇◇まとめ◇◇
- スパン名ごとに処理時間の集計・解析
- ファイルサイズが大きい場合のシナリオについて負荷検証実施。
- GraphQL API 負荷検証準備　90%程度完了。

◇◇詳細◇◇
⚪︎スパン名ごとに処理時間の集計・解析
- OpenTelemetryでサービスにスパンを付与済みで、そのスパンをもとにして処理時間の集計・解析できるスクリプトを作成完了

→TraceExplorerやCloud Monitoringは表現の柔軟性に難あり。とくにトレース・スパンが大量にある時に、結局どの処理に時間が掛かっているのかわかりずらい。

さらに処理ごとのヒストグラムがあることも、認知負荷が高まってわかりずらい。平均値や分散、95%ile、99%ileの数値だけでも、イメージが湧きずらい。

ということで下記のようなイメージで、バイオリンプロットを作成しています。バイオリンプロットはこのような統計量の表現が豊かなので、私は好きです。
![[all_spans_violin_plot.jpeg]]
懸念：
- TracrExplorer APIがv1, v2とある中、v1を使用中。サポートが今年中に切れる可能性あり。
- 現状、API エンドポイントのあるサービスにしか解析できない。エンドポイントのないサービス（MQからメッセージを受けるタイプ）を独立に検証できない。
- Pythonにpikaというライブラリがあるらしく、MQにメッセージングができるとのこと。Gatlingでもできると思うが、調査中。

⚪︎ファイルサイズが大きい場合のシナリオについて負荷検証実施。
- purchase 1KB, 5KB 10KBにおいて試しに検証中
- レスポンスまでは1KBは27 sec, 10KBでは32 sec。１回のリクエストなので、キャッシュなどが効いていない状態での測定。※それぞれN1測定。
- キュー通過後の処理群は10 ~ 50 msec。問題なし。
- 前段処理のサービスのトレースが取得できていないことが発覚。原因調査中。

最新のブランチをプルして、試しにローカルサーバにリクエストしている。
ローカルでもエラー発生。過去に使っていたリクエストでエラーなので、デグレしている？

⚪︎GraphQL API 負荷検証準備　7/23 〆切
- 井堂さんが藤さんに依頼中のGraphQL APIについて、兒玉が負荷検証を実施することで決定
- 定期的（e.g. 月一程度）でO(100)の店舗からリクエストされる想定で負荷をかけられるように調整中
- 藤さんのGraphQL API作成の方が未完成。そこで、旧版のAPIの方で一旦シナリオ作成完了。ページネーション機能が追加されるので、単純な置き換えにはならないが、そこまで時間はかからない想定。

【その他】　
- 評価面談/ 辰夫さん、平石さん
- stock-conversion-serviceのAPIが正常か監視するツール作成。１時間ごとにHTTP statusをSlackに通知。

# 来週

【営業在庫】　
- スパンレベルのボトルネック調査用のスクリプト調整　継続中
- GraphQL API負荷検証　7/23　〆切
- 前段処理サービスにトレースが現れない不具合を調査
- 大きいファイルサイズによる負荷検証
- 大きいファイルサイズによる負荷検証後のレポートとボトルネック原因調査

【その他】　
- 業務効率化研修
- Kubernetes Hands On

# その他

## 世界線

世界線という言葉が日常で使われるようになったのはいつ頃なのでしょうか？

下記リンクによると、2010年代ごろから使われるようになった言葉で、アニメ「シュタインズゲート」の作中に登場します。
https://crd.ndl.go.jp/reference/entry/index.php?page=ref_view&id=1000322589

このリンクの内容の真偽は定かではないですが、私がシュタインズ
