---
template: Inbox
title: 営業在庫負荷検証プロンプト
date: 2025-07-08
source: ソースを入れてください
tags:
  - 営業在庫
  - 負荷検証
  - プロンプトエンジニアリング
status: pending
priority: 高
aliases:
  - Gemini
---

# 概要
- 

# 本論

```
# 役割
あなたはCloudにデプロイされたマイクロサービスの負荷検証経験が豊富なエンジニアです。

# 現状
## 環境
私は現在、とある小売企業の基幹システム開発をしています。基幹システムはマイクロサービスアーキテクチャを採用しています。言語はKotlinを使用し、Cloud nativeなフレームワークであるQuarkusで開発しています。ビルドツールはGradleです。

## システムの詳細
担当しているシステムの名前は`stock-converision-service`と`new-stock-service`です。2つのマイクロサービスの間はRabbitMQで非同期通信でメッセージングしています。

つまり
stock-converision-service --> RabbitMQ --> new-stock-service
というフローです。

stock-conversion-serviceは/importエンドポイントを保有しています。この/importへリクエストすると、Cloud Pub/Subを経由し、Cloud Storageにリソースをダウンロードします。そして、レコードごとに適切な形に変換し、RabbitMQを介して、new-stock-serviceへenqueueします。

new-stock-serviceでは現在の在庫状況の値と、取引の履歴を永続化します。

## 負荷検証
全体としてOpenTelemetryを導入しています。トレースを伝播させることで、システム全体のE２Eの処理時間の計測に成功しています。一方で、より細かな粒度では測定できていません。

現状、測定方法として、Cloud Logging APIを使用しています。Cloud Logging APIに一回の処理に対して一意なトレースIDが振られているため、ログのメッセージをキーにして、ログのタイイムスタンプを割り出すことができています。これによって、より細かな粒度でサービスの処理時間を観測することができます。


# 課題と依頼
しかしながら、これでは関数ごとの時間を割り出すことができません。なぜなら、非同期通信で処理されているため、ログを追跡することが難しいです。Aという処理が終わった後、Bへ移るとすると、AがA1, A2, A3, ...とシーケンシャルに並んでいたとしても、B1, B2, B3, ...はどんどん実行されていまうのです。A1, A2, B1, A3, B3, A2, ...と並ぶようなものです。より正確にいうと、固有の番号が現状見えていない認識なので、A, A, B, A, B, A, ...と、どの処理がどれに対応しているかわからないのです。

これを解決するために２通りあると考えています。
1. 親スパンと子スパンに着目する
2. トレースエクスプローラAPIを使用する

ちょっと説明が難しいですが、どちらの方がいいと思いますか？

```

# 🔗 関連
